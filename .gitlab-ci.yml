image: dumux-precice:3.1-1.6.1

build:
  stage: build
  script:
    - export DUNE_CONTROL_PATH=${PWD}/dumux-precice:${DUNE_CONTROL_PATH}
    - echo $DUNE_CONTROL_PATH
    - dunecontrol --only=dumux-precice --opts=/home/dumux/dumux-3.1/dumux/cmake.opts  all
    - cd build-cmake/appl/coupling-ff-pm/iterative-reversed/
    - make -j2 test_ff_reversed test_pm_reversed
  artifacts:
    expire_in: 3 days
    paths:
      - build-cmake/appl/coupling-ff-pm/iterative-reversed/test_ff_reversed
      - build-cmake/appl/coupling-ff-pm/iterative-reversed/test_pm_reversed
      - build-cmake/CMakeFiles/CMakeError.log
      - build-cmake/CMakeFiles/CMakeOutput.log

test:
  stage: test
  needs: build
  script:
    - cd dumux-precice/build-cmake/
    - ctest
